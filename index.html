<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nemus</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#111827">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://placehold.co/192x192/111827/3b82f6?text=N">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #f3f4f6;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }

        /* Tile Transitions */
        .tile { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Modal Animation */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 200ms, transform 200ms; }
        .modal-exit { opacity: 1; transform: scale(1); }
        .modal-exit-active { opacity: 0; transform: scale(0.95); transition: opacity 200ms, transform 200ms; }

        /* Range Slider */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%;
            background: #3b82f6; cursor: pointer; margin-top: -6px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #374151; border-radius: 2px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-gray-900 border-b border-gray-800 sticky top-0 z-20 shadow-lg select-none">
        <div class="max-w-7xl mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
            
            <div class="flex items-center gap-4">
                <div class="relative w-16 h-16 flex items-center justify-center">
                    <svg class="w-full h-full transform -rotate-90">
                        <circle cx="32" cy="32" r="28" stroke="#374151" stroke-width="4" fill="transparent" />
                        <circle id="score-circle" cx="32" cy="32" r="28" stroke="currentColor" stroke-width="4" fill="transparent" 
                            stroke-dasharray="175.9" stroke-dashoffset="0" class="text-green-500 transition-all duration-1000" />
                    </svg>
                    <span id="life-score" class="absolute text-xl font-bold">100</span>
                </div>
                <div>
                    <h1 class="text-xl font-bold tracking-tight text-white">Nemus</h1>
                    <p class="text-xs text-gray-400">Life Score</p>
                </div>
            </div>

            <div class="flex items-center gap-6 w-full md:w-auto justify-center">
                <div class="flex items-center gap-2 w-32">
                    <i class="fas fa-th text-gray-500 text-xs"></i>
                    <input type="range" id="zoom-slider" min="0" max="2" step="1" value="0">
                    <i class="fas fa-stop text-gray-500 text-xs"></i>
                </div>

                <button onclick="openModal('add-modal')" class="bg-blue-600 hover:bg-blue-500 text-white p-3 rounded-full shadow-lg transition transform hover:scale-105 active:scale-95">
                    <i class="fas fa-plus"></i>
                </button>
                <button onclick="openSettings()" class=a hover:text-white transition">
                    <i class="fas fa-cog text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow p-4 md:p-8 overflow-y-auto pb-24">
        <div id="grid-container" class="grid gap-2 mx-auto transition-all duration-300">
            </div>
        
        <div id="empty-state" class="hidden flex flex-col items-center justify-center mt-20 text-gray-500">
            <i class="fas fa-seedling text-6xl mb-4 text-gray-700"></i>
            <h2 class="text-2xl font-semibold mb-2">Start your garden</h2>
            <p>Add meaningful activities to keep alive.</p>
        </div>
    </main>

    <div id="add-modal" class="fixed inset-0 bg-black bg-opacity-80 hidden z-50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-gray-800 rounded-xl p-6 w-full max-w-md border border-gray-700 shadow-2xl transform transition-all">
            <h2 class="text-xl font-bold mb-4">New Activity</h2>
            <form id="add-form" onsubmit="handleAddTask(event)">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-400 mb-1">Title</label>
                    <input type="text" id="task-title" required class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500" placeholder="e.g., Call Mom">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-400 mb-1">Frequency (Days)</label>
                    <input type="number" id="task-freq" required min="1" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-blue-500" placeholder="7">
                </div>
                <div class="flex justify-end gap-3">
                    <button type="button" onclick="closeModal('add-modal')" class="px-4 py-2 rounded-lg text-gray-400 hover:text-white">Cancel</button>
                    <button type="submit" class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white font-medium">Create Tile</button>
                </div>
            </form>
        </div>
    </div>

    <div id="detail-modal" class="fixed inset-0 bg-black bg-opacity-80 hidden z-50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-gray-800 rounded-xl p-6 w-full max-w-sm border border-gray-700 shadow-2xl text-center transform transition-all relative">
            <button onclick="closeModal('detail-modal')" class="absolute top-4 right-4 text-gray-500 hover:text-white w-8 h-8 flex items-center justify-center z-10">
                <i class="fas fa-times"></i>
            </button>
            
            <div id="detail-view-main">
                <div id="detail-color-indicator" class="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-gray-700 shadow-inner transition-colors duration-500"></div>
                
                <div class="mb-1 relative group">
                    <h2 id="detail-title-display" onclick="startEdit('title')" class="text-2xl font-bold break-words cursor-pointer border-b border-transparent hover:border-gray-500 inline-block transition-colors" title="Click to edit"></h2>
                    <i class="fas fa-pen text-xs text-gray-600 absolute top-2 -right-4 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                    <input id="detail-title-input" type="text" class="hidden w-full bg-gray-900 border border-blue-500 rounded p-2 text-center font-bold text-xl text-white focus:outline-none" onblur="saveEdit('title')" onkeydown="handleEditKey(event, 'title')">
                </div>

                <div class="mb-6 relative group inline-block">
                    <p id="detail-freq-display" onclick="startEdit('freq')" class="text-gray-400 text-sm cursor-pointer border-b border-transparent hover:border-gray-500 inline-block transition-colors" title="Click to edit"></p>
                    <div id="detail-freq-input-wrapper" class="hidden flex items-center justify-center gap-2">
                        <span class="text-gray-500 text-sm">Every</span>
                        <input id="detail-freq-input" type="number" min="1" class="w-20 bg-gray-900 border border-blue-500 rounded p-1 text-center text-sm text-white focus:outline-none" onblur="saveEdit('freq')" onkeydown="handleEditKey(event, 'freq')">
                        <span class="text-gray-500 text-sm">days</span>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-6 text-left bg-gray-900 p-4 rounded-lg">
                    <div>
                        <p class="text-xs text-gray-500">Last Done</p>
                        <p id="detail-last" class="font-mono text-sm">2 days ago</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500">Health</p>
                        <p id="detail-health" class="font-mono text-sm font-bold">100%</p>
                    </div>
                </div>

                <div class="flex flex-col gap-3">
                    <button onclick="handleDoneNow()" class="w-full py-4 bg-green-600 hover:bg-green-500 rounded-lg text-white font-bold text-lg shadow-lg transition-transform active:scale-95 flex items-center justify-center gap-2">
                        <i class="fas fa-check"></i> Done Now
                    </button>
                    
                    <div class="border-t border-gray-700 pt-2 mt-2">
                        <button onclick="toggleAdvanced()" class="text-xs text-gray-400 hover:text-blue-400 flex items-center justify-center w-full gap-2 py-2 transition-colors">
                            <span>Advanced Options</span>
                            <i id="adv-chevron" class="fas fa-chevron-down transition-transform duration-300"></i>
                        </button>
                        
                        <div id="detail-advanced" class="hidden overflow-hidden transition-all duration-300 ease-in-out">
                            <div class="bg-gray-900/50 p-3 rounded-lg mt-2 text-left border border-gray-700/50">
                                <label class="block text-xs text-gray-500 mb-2 font-medium">Manually set 'Last Done':</label>
                                <input type="datetime-local" id="manual-date-input" onchange="updateDateManually()" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-2 text-xs text-white focus:outline-none focus:border-blue-500 font-mono">
                            </div>
                        </div>
                    </div>

                    <button onclick="showDeleteConfirm()" class="text-red-900 hover:text-red-500 text-xs py-3 transition mt-2">Delete Activity</button>
                </div>
            </div>

            <div id="detail-view-confirm" class="hidden py-8">
                <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
                <h3 class="text-lg font-bold mb-2">Are you sure?</h3>
                <p class="text-sm text-gray-400 mb-6">This will permanently remove this activity.</p>
                <div class="flex gap-2 justify-center">
                    <button onclick="cancelDelete()" class="px-4 py-2 rounded bg-gray-700 hover:bg-gray-600 text-white">Cancel</button>
                    <button onclick="confirmDelete()" class="px-4 py-2 rounded bg-red-600 hover:bg-red-500 text-white">Yes, Delete</button>
                </div>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-80 hidden z-50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-gray-800 rounded-xl p-6 w-full max-w-md border border-gray-700 shadow-2xl">
            <h2 class="text-xl font-bold mb-4">Settings</h2>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-400 mb-2">Backup / Restore</label>
                <textarea id="data-io-area" rows="6" class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2 text-xs font-mono text-gray-300 focus:outline-none focus:border-blue-500 placeholder-gray-600" placeholder="Copy data from here to backup. Paste data here to restore."></textarea>
            </div>

            <div class="flex gap-2 mb-6">
                <button onclick="copyDataToClipboard()" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white py-2 rounded text-sm transition">
                    <i class="fas fa-copy mr-1"></i> Copy
                </button>
                <button onclick="loadDataFromTextarea()" class="flex-1 bg-blue-900 hover:bg-blue-800 text-blue-100 py-2 rounded text-sm transition">
                    <i class="fas fa-upload mr-1"></i> Load
                </button>
            </div>

            <div class="border-t border-gray-700 pt-4 mt-4">
                <button onclick="clearAllData()" class="w-full py-2 text-red-500 hover:text-red-400 text-sm border border-red-900/50 rounded hover:bg-red-900/20 transition">
                    <i class="fas fa-trash mr-2"></i> Reset Application
                </button>
            </div>

            <div class="mt-4 flex justify-end">
                <button onclick="closeModal('settings-modal')" class="px-4 py-2 rounded text-gray-400 hover:text-white">Close</button>
            </div>
        </div>
    </div>

    <script>
        // --- PWA Registration ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.log('SW registration failed: ', err));
            });
        }

        // --- State Management ---
        let tasks = [];
        let zoomLevel = 0; 
        let currentDetailId = null;
        
        // --- Constants ---
        const COLORS = {
            good: { r: 34, g: 197, b: 94 },
            mid: { r: 239, g: 68, b: 68 },
            dead: { r: 17, g: 24, b: 39 } 
        };

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            setupZoom();
            render();
            setInterval(render, 60000); 
        });

        // --- Logic ---
        function calculateHealth(task) {
            const now = new Date();
            const last = new Date(task.last_done_at);
            const diffMs = now - last;
            const diffDays = diffMs / (1000 * 60 * 60 * 24);
            const f = task.frequency_days;

            let health = 0;
            if (diffDays <= f) health = 100;
            else if (diffDays < (2 * f)) health = 100 * (2 - (diffDays / f));
            else health = 0;

            return { value: Math.max(0, Math.min(100, health)), daysSince: diffDays };
        }

        function getHealthColor(health) {
            let r, g, b;
            if (health >= 50) {
                const t = (health - 50) / 50; 
                r = Math.round(COLORS.mid.r + (COLORS.good.r - COLORS.mid.r) * t);
                g = Math.round(COLORS.mid.g + (COLORS.good.g - COLORS.mid.g) * t);
                b = Math.round(COLORS.mid.b + (COLORS.good.b - COLORS.mid.b) * t);
            } else {
                const t = health / 50;
                r = Math.round(COLORS.dead.r + (COLORS.mid.r - COLORS.dead.r) * t);
                g = Math.round(COLORS.dead.g + (COLORS.mid.g - COLORS.dead.g) * t);
                b = Math.round(COLORS.dead.b + (COLORS.mid.b - COLORS.dead.b) * t);
            }
            return `rgb(${r}, ${g}, ${b})`;
        }

        function getInitials(title) {
            return title.split(' ').map(w => w[0]).join('').substring(0, 3).toUpperCase();
        }

        // --- Rendering ---
        function setupZoom() {
            const slider = document.getElementById('zoom-slider');
            slider.value = localStorage.getItem('nemus_app_zoom') || 0;
            zoomLevel = parseInt(slider.value);
            slider.addEventListener('input', (e) => {
                zoomLevel = parseInt(e.target.value);
                localStorage.setItem('nemus_app_zoom', zoomLevel);
                renderGrid();
            });
        }

        function render() {
            renderGrid();
            renderScore();
        }

        function renderScore() {
            if (tasks.length === 0) {
                document.getElementById('life-score').innerText = '-';
                document.getElementById('score-circle').style.stroke = '#374151';
                document.getElementById('score-circle').style.strokeDashoffset = 175.9;
                return;
            }
            let totalHealth = 0;
            tasks.forEach(t => totalHealth += calculateHealth(t).value);
            const score = Math.round(totalHealth / tasks.length);
            
            document.getElementById('life-score').innerText = score;
            const circle = document.getElementById('score-circle');
            circle.style.strokeDashoffset = 175.9 - (score / 100) * 175.9;
            circle.style.stroke = getHealthColor(score);
        }

        function renderGrid() {
            const container = document.getElementById('grid-container');
            const emptyState = document.getElementById('empty-state');
            container.innerHTML = '';

            if (tasks.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            } else {
                emptyState.classList.add('hidden');
            }

            let gridCols = '';
            if (zoomLevel === 0) gridCols = 'grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5';
            if (zoomLevel === 1) gridCols = 'grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10';
            if (zoomLevel === 2) gridCols = 'grid-cols-8 sm:grid-cols-12 md:grid-cols-16 lg:grid-cols-20 gap-1';
            
            container.className = `grid mx-auto ${gridCols}`;

            tasks.forEach(task => {
                const healthData = calculateHealth(task);
                const color = getHealthColor(healthData.value);
                const tile = document.createElement('div');
                
                tile.className = `tile cursor-pointer relative rounded-lg overflow-hidden shadow-md hover:shadow-xl hover:scale-105 transform border border-gray-800 select-none`;
                tile.style.backgroundColor = color;
                tile.onclick = () => openDetail(task.id);

                if (zoomLevel === 0) {
                    tile.classList.add('aspect-square', 'p-4', 'flex', 'flex-col', 'justify-between');
                    const daysAgo = Math.floor(healthData.daysSince);
                    const timeText = daysAgo === 0 ? 'Today' : `${daysAgo}d ago`;
                    tile.innerHTML = `
                        <div class="font-bold text-lg leading-tight drop-shadow-md break-words">${task.title}</div>
                        <div class="text-xs font-mono opacity-80 drop-shadow-md flex justify-between items-end">
                            <span>Every ${task.frequency_days}d</span>
                            <span>${timeText}</span>
                        </div>
                    `;
                } else if (zoomLevel === 1) {
                    tile.classList.add('aspect-square', 'flex', 'items-center', 'justify-center');
                    tile.innerHTML = `<span class="font-bold text-xl drop-shadow-md select-none">${getInitials(task.title)}</span>`;
                } else {
                    tile.classList.add('aspect-square');
                    tile.title = task.title;
                }
                container.appendChild(tile);
            });
        }

        // --- Actions ---
        function handleAddTask(e) {
            e.preventDefault();
            const title = document.getElementById('task-title').value;
            const freq = parseInt(document.getElementById('task-freq').value);
            
            tasks.push({
                id: crypto.randomUUID(),
                title: title,
                frequency_days: freq,
                last_done_at: new Date().toISOString(),
                created_at: new Date().toISOString()
            });
            
            saveData();
            render();
            closeModal('add-modal');
            e.target.reset();
        }

        // --- Detail View Logic (Updated) ---

        function openDetail(id) {
            currentDetailId = id;
            const task = tasks.find(t => t.id === id);
            if (!task) return;

            // Reset View States
            document.getElementById('detail-view-main').classList.remove('hidden');
            document.getElementById('detail-view-confirm').classList.add('hidden');
            
            // Reset Edit States
            document.getElementById('detail-title-display').classList.remove('hidden');
            document.getElementById('detail-title-input').classList.add('hidden');
            document.getElementById('detail-freq-display').classList.remove('hidden');
            document.getElementById('detail-freq-input-wrapper').classList.add('hidden');

            // Reset Advanced Section
            document.getElementById('detail-advanced').classList.add('hidden');
            document.getElementById('adv-chevron').style.transform = 'rotate(0deg)';

            updateDetailContent(task);
            openModal('detail-modal');
        }

        // Helper to refresh content inside modal without closing it
        function updateDetailContent(task) {
            const healthData = calculateHealth(task);
            const daysAgo = Math.floor(healthData.daysSince);
            
            // Populate Text
            document.getElementById('detail-title-display').innerText = task.title;
            document.getElementById('detail-freq-display').innerText = `Every ${task.frequency_days} days`;
            document.getElementById('detail-last').innerText = daysAgo === 0 ? 'Today' : `${daysAgo} days ago`;
            
            // Populate Inputs (for editing)
            document.getElementById('detail-title-input').value = task.title;
            document.getElementById('detail-freq-input').value = task.frequency_days;

            // Populate Health
            const healthEl = document.getElementById('detail-health');
            healthEl.innerText = Math.round(healthData.value) + '%';
            healthEl.style.color = getHealthColor(healthData.value);
            document.getElementById('detail-color-indicator').style.backgroundColor = getHealthColor(healthData.value);

            // Populate Manual Date Picker (Convert ISO to local datetime-local format)
            const d = new Date(task.last_done_at);
            d.setMinutes(d.getMinutes() - d.getTimezoneOffset()); // Adjust for timezone
            document.getElementById('manual-date-input').value = d.toISOString().slice(0, 16);
        }

        // --- Inline Editing Functions ---

        function startEdit(type) {
            if (type === 'title') {
                document.getElementById('detail-title-display').classList.add('hidden');
                const inp = document.getElementById('detail-title-input');
                inp.classList.remove('hidden');
                inp.focus();
            } else if (type === 'freq') {
                document.getElementById('detail-freq-display').classList.add('hidden');
                const wrapper = document.getElementById('detail-freq-input-wrapper');
                wrapper.classList.remove('hidden');
                document.getElementById('detail-freq-input').focus();
            }
        }

        function saveEdit(type) {
            const task = tasks.find(t => t.id === currentDetailId);
            if (!task) return;

            if (type === 'title') {
                const val = document.getElementById('detail-title-input').value.trim();
                if (val) task.title = val;
                document.getElementById('detail-title-input').classList.add('hidden');
                document.getElementById('detail-title-display').classList.remove('hidden');
            } else if (type === 'freq') {
                const val = parseInt(document.getElementById('detail-freq-input').value);
                if (val && val > 0) task.frequency_days = val;
                document.getElementById('detail-freq-input-wrapper').classList.add('hidden');
                document.getElementById('detail-freq-display').classList.remove('hidden');
            }

            saveData();
            render();
            updateDetailContent(task); // Refresh modal to show changes
        }

        function handleEditKey(e, type) {
            if (e.key === 'Enter') {
                saveEdit(type);
            }
        }

        // --- Advanced Options Functions ---

        function toggleAdvanced() {
            const section = document.getElementById('detail-advanced');
            const chevron = document.getElementById('adv-chevron');
            
            if (section.classList.contains('hidden')) {
                section.classList.remove('hidden');
                chevron.style.transform = 'rotate(180deg)';
            } else {
                section.classList.add('hidden');
                chevron.style.transform = 'rotate(0deg)';
            }
        }

        function updateDateManually() {
            const val = document.getElementById('manual-date-input').value;
            if (!val || !currentDetailId) return;

            const task = tasks.find(t => t.id === currentDetailId);
            if (task) {
                // Create date object from input and convert back to ISO
                task.last_done_at = new Date(val).toISOString();
                saveData();
                render();
                updateDetailContent(task);
            }
        }

        function handleDoneNow() {
            if (!currentDetailId) return;
            const task = tasks.find(t => t.id === currentDetailId);
            if (task) {
                task.last_done_at = new Date().toISOString();
                saveData();
                render();
                closeModal('detail-modal');
            }
        }

        function showDeleteConfirm() {
            document.getElementById('detail-view-main').classList.add('hidden');
            document.getElementById('detail-view-confirm').classList.remove('hidden');
        }

        function cancelDelete() {
            document.getElementById('detail-view-main').classList.remove('hidden');
            document.getElementById('detail-view-confirm').classList.add('hidden');
        }

        function confirmDelete() {
            if (!currentDetailId) return;
            tasks = tasks.filter(t => t.id !== currentDetailId);
            saveData();
            render();
            closeModal('detail-modal');
            currentDetailId = null;
        }

        // --- Settings / Export ---
        function openSettings() {
            const textArea = document.getElementById('data-io-area');
            textArea.value = JSON.stringify(tasks, null, 2);
            openModal('settings-modal');
        }

        function copyDataToClipboard() {
            const textArea = document.getElementById('data-io-area');
            textArea.select();
            document.execCommand('copy');
            alert('Copied to clipboard');
        }

        function loadDataFromTextarea() {
            const text = document.getElementById('data-io-area').value;
            try {
                const parsed = JSON.parse(text);
                if (Array.isArray(parsed)) {
                    tasks = parsed;
                    saveData();
                    render();
                    alert('Loaded successfully');
                    closeModal('settings-modal');
                } else {
                    alert('Invalid data format');
                }
            } catch (e) {
                alert('Invalid JSON');
            }
        }

        function clearAllData() {
            const check = prompt("Type 'DELETE' to wipe all data:");
            if (check === 'DELETE') {
                tasks = [];
                saveData();
                render();
                closeModal('settings-modal');
            }
        }

        // --- Storage ---
        function saveData() {
            localStorage.setItem('nemus_app_tasks', JSON.stringify(tasks));
        }

        function loadData() {
            const stored = localStorage.getItem('nemus_app_tasks');
            if (stored) {
                try {
                    tasks = JSON.parse(stored);
                } catch(e) { tasks = []; }
            }
        }

        // --- Modal Helpers ---
        function openModal(id) {
            const modal = document.getElementById(id);
            modal.classList.remove('hidden');
            setTimeout(() => {
                const content = modal.firstElementChild;
                content.classList.remove('scale-95', 'opacity-0');
                content.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeModal(id) {
            const modal = document.getElementById(id);
            const content = modal.firstElementChild;
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            setTimeout(() => modal.classList.add('hidden'), 200);
        }

        window.onclick = (e) => {
            if (e.target.classList.contains('fixed')) closeModal(e.target.id);
        };
    </script>
</body>
</html>
